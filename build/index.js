!function(e){var t={};function s(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,s),o.l=!0,o.exports}s.m=e,s.c=t,s.d=function(e,t,i){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)s.d(i,o,function(t){return e[t]}.bind(null,o));return i},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=5)}([function(e,t){e.exports=require("path")},function(e,t){e.exports=require("express")},function(e,t,s){"use strict";(function(e){s.d(t,"a",(function(){return d}));var i=s(1),o=s.n(i),r=s(3),n=s.n(r),c=s(4),a=s(0),l=s.n(a);class d{constructor(){this.activeSockets=[],this.DEFAULT_PORT=5e3,this.broadcasterSocket=void 0,this.casterSocket=void 0,this.observerSocket=void 0,this.initialize()}initialize(){this.app=o()(),this.httpServer=Object(c.createServer)(this.app),this.io=n()(this.httpServer),this.configureApp(),this.configureRoutes(),this.handlePlayerConnection()}configureApp(){this.app.use(o.a.static(l.a.join(e,"../public")))}configureRoutes(){this.app.get("/",(e,t)=>{t.sendFile(l.a.resolve("public/player.html")),this.handlePlayerConnection()}),this.app.get("/observer",(e,t)=>{null==this.observerSocket?(t.sendFile(l.a.resolve("public/observer.html")),this.handleObserver()):t.send("<h1 style='text-align: center'>Observer already connected!</h1>")}),this.app.get("/caster",(e,t)=>{null==this.casterSocket?(t.sendFile(l.a.resolve("public/caster.html")),this.handleCaster()):t.send("<h1 style='text-align: center'>Caster already connected!</h1>")}),this.app.get("/broadcaster",(e,t)=>{null==this.broadcasterSocket?(t.sendFile(l.a.resolve("public/broadcaster.html")),this.handleBroadcaster()):t.send("<h1 style='text-align: center'>Broadcaster already connected!</h1>")})}handlePlayerConnection(){this.io.on("connection",e=>{this.activeSockets.find(t=>t===e.id)||(this.activeSockets.push(e.id),e.emit("update-user-list",{users:this.activeSockets.filter(t=>t!==e.id)}),e.broadcast.emit("update-user-list",{users:[e.id]})),e.on("call-user",t=>{e.to(t.to).emit("call-made",{offer:t.offer,socket:e.id})}),e.on("make-answer",t=>{e.to(t.to).emit("answer-made",{socket:e.id,answer:t.answer})}),e.on("disconnect",()=>{console.log("user disconnected"),this.activeSockets=this.activeSockets.filter(t=>t!==e.id),e.broadcast.emit("remove-user",{socketId:e.id})})})}handleObserver(){this.io.on("connection",e=>{this.observerSocket=e,e.broadcast.emit("update-user-list",{users:[e.id]}),e.on("call-user",t=>{e.to(t.to).emit("call-made",{offer:t.offer,socket:e.id})}),e.on("make-answer",t=>{e.to(t.to).emit("answer-made",{socket:e.id,answer:t.answer})}),e.on("disconnect",()=>{null!=this.casterSocket&&e.to(this.casterSocket).emit("obs-dc"),console.log("observer disconnected"),this.observerSocket=void 0})})}handleCaster(){}handleBroadcaster(){this.io.on("connection",e=>{this.activeSockets.find(t=>t===e.id)||(this.activeSockets.push(e.id),e.emit("update-user-list",{users:this.activeSockets.filter(t=>t!==e.id)}),e.broadcast.emit("update-user-list",{users:[e.id]})),e.on("call-user",t=>{e.to(t.to).emit("call-made",{offer:t.offer,socket:e.id})}),e.on("make-answer",t=>{e.to(t.to).emit("answer-made",{socket:e.id,answer:t.answer})}),e.on("disconnect",()=>{console.log("user disconnected"),this.activeSockets=this.activeSockets.filter(t=>t!==e.id),e.broadcast.emit("remove-user",{socketId:e.id})})})}listen(e){this.httpServer.listen(this.DEFAULT_PORT,()=>{e(this.DEFAULT_PORT)})}}}).call(this,"/")},function(e,t){e.exports=require("socket.io")},function(e,t){e.exports=require("http")},function(e,t,s){"use strict";s.r(t);(new(s(2).a)).listen(e=>{console.log(`Server is listening on http://localhost:${e}/caster`)})}]);